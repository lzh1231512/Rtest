@using DL91;
@{
    ViewData["Title"] = "Home Page";
    var TypeLst = ViewBag.TypeLst as List<DBType>;
}
@model DL91.Models.SearchViewModel
<style>
    body {
        padding-top: 10px;
    }
</style>
<script src="~/js/IndexDB.js"></script>
<script src="~/js/cacheM3u8.js"></script>
<form>
    <div class="panel panel-info">
        <div class="panel-heading" id="TelescopicHead" data-toggle="collapse" data-target="#SalesOrderSearchArea">
            <h3 class="panel-title" id="displaySearchConfig">
                Search Area <span id="displayDowntask"></span>
            </h3>
        </div>
        <div id="SalesOrderSearchArea" data-enter-to-search="#btnSubmitSalesOrderSearch" class="panel-body in searchArea">
            <div class="row">
                <div class="col-md-3">
                    @Html.Label("", "Type")
                    <select id="typeId" name="typeId" class="form-control">
                        @foreach (var item in TypeLst)
                        {
                            @Html.Raw("<option " + (Model.typeId == item.id ? "selected=\"selected\"" : "") + "  value='" + item.id + "'>" + item.name + "</option>");
                        }
                    </select>
                </div>
                <div class="col-md-3">
                    @Html.Label("", "Contains")
                    @Html.EditorFor(m => m.title1, new { htmlAttributes = new { @class = "form-control" } })
                </div>
                <div class="col-md-3">
                    @Html.Label("", "Not Contains")
                    @Html.EditorFor(m => m.title2, new { htmlAttributes = new { @class = "form-control" } })
                </div>
                <div class="col-md-3">
                    @Html.Label("", "Is Like")
                    <select id="isLike" name="isLike" class="form-control">
                        @Html.Raw("<option " + (Model.isLike == 2 ? "selected=\"selected\"" : "") + "  value='2'>ALL</option>");
                        @Html.Raw("<option " + (Model.isLike == 1 ? "selected=\"selected\"" : "") + "  value='1'>Like</option>");
                        @Html.Raw("<option " + (Model.isLike == 0 ? "selected=\"selected\"" : "") + "  value='0'>No Like</option>");
                    </select>
                </div>
            </div>
            <div class="row" style="margin-top:10px;">
                <div class="col-md-12 form-button-Lines">
                    <button id="btnSubmitSalesOrderSearch" class="btn btn-info CommonBtn"><i class='fa fa-search'></i> Search</button>
                    <input id="btnClear" type="button" class="btn btn-default CommonBtn" value="Clear All" />
                    <input id="btnSync" type="button" class="btn btn-default CommonBtn" value="Sync Now" />
                </div>
            </div>
        </div>
    </div>
    <div id="SalesOrderResult">
        @Html.Partial("_List", Model)
    </div>
</form>
<script>
    loadStyle(['@Url.Content("~/css/pager.css")', '@Url.Content("~/css/font-awesome.css")']);
    loadjs(['@Url.Content("~/js/ajaxpager/ajaxpager.js?t=4")']);
    function onPageLoad() {
        window.scrollTo(0, 0);
    }
    function play(obj,id) {
        var xxurl = window.location.href;
        if (xxurl.indexOf('/',10) > 0) {
            xxurl = xxurl.substr(0, xxurl.indexOf('/', 10));
        }
        if (xxurl.indexOf('?') > 0) {
            xxurl = xxurl.substr(0, xxurl.indexOf('?'));
        }
        if (xxurl.indexOf('#') > 0) {
            xxurl = xxurl.substr(0, xxurl.indexOf('#'));
        }
        var url = '@Url.Action("play")?id=' + id + '&url=' + encodeURIComponent(xxurl);
        obj.href = url;
    }
    $(function () {
        $('#btnClear').click(function(){
            $('#title1,#title2').val('');
            $('#isLike').val(2);
        });
        $('#btnSync').click(function () {
            $.post('@Url.Action("sync")');
            alert('OK');
        });
        m3u8.initDownload(function (taskCount) {
            $('#displayDowntask').html('('+taskCount+')');
        });
    });
    history.pushState(null, null, location.href);
    window.addEventListener('popstate', function (event) {
        if ($('#hicurrentPage').val() != '1') {
            history.pushState(null, null, location.href);
            $('span.btnprevious').click();
        }
    });
</script>